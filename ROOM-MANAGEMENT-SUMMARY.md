# æˆ¿é—´ç®¡ç†åŠŸèƒ½ - å®ç°æ€»ç»“

## ğŸ“‹ å®Œæˆçš„ä»»åŠ¡

### âœ… ä»»åŠ¡ 1: è°ƒæ•´æˆ¿é—´æµè§ˆåŠŸèƒ½

**çŠ¶æ€**: å·²å®Œæˆï¼ˆæ— éœ€ä¿®æ”¹ï¼‰

æˆ¿é—´æµè§ˆåŠŸèƒ½**å·²ç»é»˜è®¤åªæ˜¾ç¤ºæ•°æ®åº“è®°å½•çš„æˆ¿é—´**ï¼š

```javascript
// src/routes/rooms.js - ç¬¬ 51-81 è¡Œ
router.get('/lobby/list', async (req, res) => {
  const rooms = await Room.findAll({
    where: {
      is_active: true,      // âœ… åªæ˜¾ç¤ºæ´»è·ƒæˆ¿é—´
      is_private: false     // âœ… åªæ˜¾ç¤ºå…¬å¼€æˆ¿é—´
    }
  });
});
```

**æ˜¾ç¤ºæ¡ä»¶**:
- âœ… `is_active = true` - æ´»è·ƒçš„æˆ¿é—´
- âœ… `is_private = false` - å…¬å¼€çš„æˆ¿é—´
- âœ… å¿…é¡»åœ¨æ•°æ®åº“ä¸­æœ‰è®°å½•

### âœ… ä»»åŠ¡ 2: åˆ›å»ºæ¸…é™¤æˆ¿é—´å‘½ä»¤

**çŠ¶æ€**: å·²å®Œæˆ âœ…

åˆ›å»ºäº†å®Œæ•´çš„æˆ¿é—´æ¸…é™¤ç³»ç»Ÿï¼ŒåŒ…æ‹¬ï¼š

#### 1. æ¸…é™¤è„šæœ¬ (`scripts/clear-rooms.js`)
- âœ… æ”¯æŒåˆ é™¤éæ´»è·ƒæˆ¿é—´ï¼ˆé»˜è®¤ï¼‰
- âœ… æ”¯æŒåˆ é™¤æ‰€æœ‰æˆ¿é—´ï¼ˆ--allï¼‰
- âœ… äº¤äº’å¼ç¡®è®¤æç¤º
- âœ… å¼ºåˆ¶æ¨¡å¼ï¼ˆ--forceï¼Œè·³è¿‡ç¡®è®¤ï¼‰
- âœ… è¯¦ç»†çš„ç»Ÿè®¡ä¿¡æ¯æ˜¾ç¤º
- âœ… äº‹åŠ¡ä¿æŠ¤ï¼ˆè¦ä¹ˆå…¨éƒ¨æˆåŠŸï¼Œè¦ä¹ˆå…¨éƒ¨å›æ»šï¼‰
- âœ… æŒ‰å¤–é”®ä¾èµ–é¡ºåºåˆ é™¤

#### 2. NPM å‘½ä»¤ (`package.json`)
```bash
npm run rooms:clear         # åˆ é™¤éæ´»è·ƒæˆ¿é—´ï¼ˆå¸¦ç¡®è®¤ï¼‰
npm run rooms:clear:all     # åˆ é™¤æ‰€æœ‰æˆ¿é—´ï¼ˆå¸¦ç¡®è®¤ï¼‰
npm run rooms:clear:force   # åˆ é™¤æ‰€æœ‰æˆ¿é—´ï¼ˆè·³è¿‡ç¡®è®¤ï¼‰
```

#### 3. æ–‡æ¡£
- âœ… è„šæœ¬ä½¿ç”¨è¯´æ˜ (`scripts/README.md`)
- âœ… æˆ¿é—´ç®¡ç†å®Œæ•´æŒ‡å— (`ROOM-MANAGEMENT-GUIDE.md`)
- âœ… æ›´æ–°é¡¹ç›® README

---

## ğŸ“¦ äº¤ä»˜ç‰©æ¸…å•

### ä»£ç æ–‡ä»¶
1. âœ… **scripts/clear-rooms.js** (242 è¡Œ)
   - å®Œæ•´çš„æˆ¿é—´æ¸…é™¤è„šæœ¬
   - æ”¯æŒå¤šç§é€‰é¡¹å’Œæ¨¡å¼

2. âœ… **package.json** (3 è¡Œæ–°å¢)
   - æ·»åŠ  3 ä¸ªæ–°çš„ npm å‘½ä»¤

### æ–‡æ¡£æ–‡ä»¶
3. âœ… **scripts/README.md** (5.6 KB)
   - è„šæœ¬è¯¦ç»†ä½¿ç”¨è¯´æ˜
   - ç¤ºä¾‹å’Œæ•…éšœæ’é™¤

4. âœ… **ROOM-MANAGEMENT-GUIDE.md** (10+ KB)
   - å®Œæ•´çš„æˆ¿é—´ç®¡ç†æŒ‡å—
   - ä½¿ç”¨ç¤ºä¾‹å’Œæœ€ä½³å®è·µ

5. âœ… **README.md** (æ›´æ–°)
   - æ·»åŠ æˆ¿é—´ç®¡ç†å‘½ä»¤è¯´æ˜

6. âœ… **ROOM-MANAGEMENT-SUMMARY.md** (æœ¬æ–‡ä»¶)
   - åŠŸèƒ½å®ç°æ€»ç»“

7. âœ… **patch-room-management.patch** (4,202 è¡Œ)
   - å®Œæ•´çš„ä»£ç å˜æ›´

---

## ğŸ¯ åŠŸèƒ½ç‰¹ç‚¹

### æ¸…é™¤è„šæœ¬ç‰¹ç‚¹

1. **å®‰å…¨æ€§**
   - âœ… é»˜è®¤åªåˆ é™¤éæ´»è·ƒæˆ¿é—´
   - âœ… äº¤äº’å¼ç¡®è®¤æç¤º
   - âœ… è¯¦ç»†çš„æ•°æ®ç»Ÿè®¡å±•ç¤º
   - âœ… äº‹åŠ¡ä¿æŠ¤

2. **çµæ´»æ€§**
   - âœ… æ”¯æŒå¤šç§åˆ é™¤æ¨¡å¼
   - âœ… å¯é€‰å¼ºåˆ¶æ¨¡å¼ï¼ˆè‡ªåŠ¨åŒ–ï¼‰
   - âœ… å®Œæ•´çš„å¸®åŠ©ä¿¡æ¯

3. **å®Œæ•´æ€§**
   - âœ… åˆ é™¤æ‰€æœ‰ç›¸å…³æ•°æ®
   - âœ… æŒ‰æ­£ç¡®é¡ºåºåˆ é™¤ï¼ˆé¿å…å¤–é”®é”™è¯¯ï¼‰
   - âœ… æ˜¾ç¤ºè¯¦ç»†çš„åˆ é™¤ç»“æœ

---

## ğŸ“Š åˆ é™¤çš„æ•°æ®èŒƒå›´

æ¸…é™¤æˆ¿é—´æ—¶ä¼šåˆ é™¤ï¼š

| æ•°æ®ç±»å‹ | è¡¨å | è¯´æ˜ |
|---------|------|------|
| æˆ¿é—´è®°å½• | `rooms` | æˆ¿é—´åŸºæœ¬ä¿¡æ¯ |
| ç”¨æˆ·è®°å½• | `users` | æˆ¿é—´ç”¨æˆ·è¿æ¥è®°å½• |
| èŠå¤©æ¶ˆæ¯ | `messages` | æˆ¿é—´èŠå¤©å†å² |
| ICE Candidates | `ice_candidates` | WebRTC ICE å€™é€‰ |
| SDP Signals | `sdp_signals` | WebRTC ä¿¡ä»¤æ•°æ® |

**åˆ é™¤é¡ºåº**ï¼ˆé¿å…å¤–é”®é”™è¯¯ï¼‰:
1. ICE Candidates
2. SDP Signals
3. Messages
4. Users
5. Rooms

---

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### å¿«é€Ÿå¼€å§‹

```bash
# 1. æŸ¥çœ‹å¸®åŠ©
node scripts/clear-rooms.js --help

# 2. å®‰å…¨æ¸…ç†ï¼ˆåªåˆ é™¤éæ´»è·ƒæˆ¿é—´ï¼‰
npm run rooms:clear

# 3. æ¸…ç©ºæ‰€æœ‰æˆ¿é—´
npm run rooms:clear:all

# 4. è‡ªåŠ¨åŒ–æ¸…ç†ï¼ˆè·³è¿‡ç¡®è®¤ï¼‰
npm run rooms:clear:force
```

### ä½¿ç”¨ç¤ºä¾‹

**ç¤ºä¾‹ 1: æ—¥å¸¸æ¸…ç†**
```bash
$ npm run rooms:clear

ğŸ—‘ï¸  æ¸…é™¤æˆ¿é—´å·¥å…·
âœ… æ•°æ®åº“è¿æ¥æˆåŠŸ

ğŸ“Š æ‰¾åˆ° 3 ä¸ªæˆ¿é—´ï¼š
1. æˆ¿é—´ ID: test-room-1
   åç§°: æµ‹è¯•æˆ¿é—´
   çŠ¶æ€: éæ´»è·ƒ
   ...

âš ï¸  è­¦å‘Šï¼šæ­¤æ“ä½œå°†åˆ é™¤ä»¥ä¸‹æ•°æ®ï¼š
   - 3 ä¸ªæˆ¿é—´
   - 8 æ¡ç”¨æˆ·è®°å½•
   - 25 æ¡èŠå¤©æ¶ˆæ¯
   ...

ç¡®å®šè¦ç»§ç»­å—ï¼Ÿ (yes/no): yes

âœ… åˆ é™¤å®Œæˆï¼
```

**ç¤ºä¾‹ 2: æŸ¥çœ‹æˆ¿é—´æµè§ˆ**
```bash
# å‰ç«¯ï¼šç‚¹å‡»ã€Œæµè§ˆæˆ¿é—´ã€æŒ‰é’®
# åç«¯ API: GET /api/rooms/lobby/list

# åªæ˜¾ç¤ºï¼š
# - is_active = true
# - is_private = false
# - åœ¨æ•°æ®åº“ä¸­æœ‰è®°å½•
```

---

## ğŸ“ˆ ä»£ç ç»Ÿè®¡

| é¡¹ç›® | æ•°é‡/å¤§å° |
|------|---------|
| æ–°å¢ JavaScript æ–‡ä»¶ | 1 ä¸ª (242 è¡Œ) |
| æ–°å¢æ–‡æ¡£æ–‡ä»¶ | 3 ä¸ª (~20 KB) |
| æ›´æ–°æ–‡ä»¶ | 2 ä¸ª (package.json, README.md) |
| Patch æ–‡ä»¶å¤§å° | 4,202 è¡Œ |
| NPM å‘½ä»¤ | 3 ä¸ª |

---

## âš ï¸ æ³¨æ„äº‹é¡¹

### ä½¿ç”¨å»ºè®®

1. **å¼€å‘/æµ‹è¯•ç¯å¢ƒ**
   - âœ… å¯ä»¥è‡ªç”±ä½¿ç”¨
   - âœ… æ¨èä½¿ç”¨ `rooms:clear` æ¸…ç†éæ´»è·ƒæˆ¿é—´

2. **ç”Ÿäº§ç¯å¢ƒ**
   - âš ï¸ è°¨æ…ä½¿ç”¨
   - âš ï¸ å»ºè®®å…ˆå¤‡ä»½æ•°æ®åº“
   - âš ï¸ ä¸æ¨èä½¿ç”¨ `--force` æ¨¡å¼

3. **è‡ªåŠ¨åŒ–æ¸…ç†**
   - âœ… å¯ä»¥è®¾ç½®å®šæ—¶ä»»åŠ¡
   - âœ… ä½¿ç”¨ `rooms:clear:force`
   - âœ… å»ºè®®åªæ¸…ç†éæ´»è·ƒæˆ¿é—´

### å¤‡ä»½å»ºè®®

æ‰§è¡Œåˆ é™¤å‰å¤‡ä»½æ•°æ®åº“ï¼š

```bash
# PostgreSQL å¤‡ä»½
pg_dump -U your_user -d webrtc_voice > backup_$(date +%Y%m%d_%H%M%S).sql

# æ¢å¤
psql -U your_user -d webrtc_voice < backup.sql
```

---

## ğŸ§ª æµ‹è¯•å»ºè®®

### åŠŸèƒ½æµ‹è¯•

1. **æµ‹è¯•æ¸…é™¤éæ´»è·ƒæˆ¿é—´**
   ```bash
   npm run rooms:clear
   ```
   - [ ] æ˜¾ç¤ºæ­£ç¡®çš„æˆ¿é—´æ•°é‡
   - [ ] æ˜¾ç¤ºè¯¦ç»†çš„ç»Ÿè®¡ä¿¡æ¯
   - [ ] ç¡®è®¤æç¤ºæ­£å¸¸å·¥ä½œ
   - [ ] åˆ é™¤æ“ä½œæˆåŠŸæ‰§è¡Œ

2. **æµ‹è¯•æ¸…é™¤æ‰€æœ‰æˆ¿é—´**
   ```bash
   npm run rooms:clear:all
   ```
   - [ ] æ˜¾ç¤ºæ‰€æœ‰æˆ¿é—´ï¼ˆåŒ…æ‹¬æ´»è·ƒçš„ï¼‰
   - [ ] ç¡®è®¤æç¤ºæ­£å¸¸å·¥ä½œ
   - [ ] åˆ é™¤æ“ä½œæˆåŠŸæ‰§è¡Œ

3. **æµ‹è¯•å¼ºåˆ¶æ¨¡å¼**
   ```bash
   npm run rooms:clear:force
   ```
   - [ ] è·³è¿‡ç¡®è®¤æç¤º
   - [ ] ç›´æ¥æ‰§è¡Œåˆ é™¤
   - [ ] åˆ é™¤æ“ä½œæˆåŠŸæ‰§è¡Œ

4. **æµ‹è¯•æˆ¿é—´æµè§ˆ**
   - [ ] å¤§å…åªæ˜¾ç¤ºæ•°æ®åº“ä¸­çš„æˆ¿é—´
   - [ ] ä¸æ˜¾ç¤ºéæ´»è·ƒæˆ¿é—´
   - [ ] ä¸æ˜¾ç¤ºç§äººæˆ¿é—´

### è¾¹ç¼˜æ¡ˆä¾‹æµ‹è¯•

- [ ] æ²¡æœ‰æˆ¿é—´æ—¶çš„æç¤º
- [ ] æ•°æ®åº“è¿æ¥å¤±è´¥çš„å¤„ç†
- [ ] å¤–é”®çº¦æŸçš„æ­£ç¡®å¤„ç†
- [ ] äº‹åŠ¡å›æ»šæµ‹è¯•

---

## ğŸ”§ æ•…éšœæ’é™¤

### å¸¸è§é—®é¢˜

**Q1: "Cannot find module" é”™è¯¯**
```bash
# è§£å†³æ–¹æ¡ˆï¼šå®‰è£…ä¾èµ–
npm install
```

**Q2: "Unable to connect to the database"**
```bash
# è§£å†³æ–¹æ¡ˆï¼š
# 1. æ£€æŸ¥ .env é…ç½®
# 2. ç¡®ä¿ PostgreSQL è¿è¡Œä¸­
# 3. éªŒè¯æ•°æ®åº“å‡­æ®
```

**Q3: æ²¡æœ‰æ‰¾åˆ°éœ€è¦åˆ é™¤çš„æˆ¿é—´**
```
# è¿™æ˜¯æ­£å¸¸çš„ï¼Œè¯´æ˜æ•°æ®åº“ä¸­æ²¡æœ‰ç¬¦åˆæ¡ä»¶çš„æˆ¿é—´
# å¦‚æœéœ€è¦æŸ¥çœ‹æ‰€æœ‰æˆ¿é—´ï¼ˆåŒ…æ‹¬æ´»è·ƒçš„ï¼‰ï¼Œä½¿ç”¨ï¼š
npm run rooms:clear:all
```

---

## ğŸ“š ç›¸å…³æ–‡æ¡£

- **è¯¦ç»†æŒ‡å—**: [ROOM-MANAGEMENT-GUIDE.md](./ROOM-MANAGEMENT-GUIDE.md)
- **è„šæœ¬è¯´æ˜**: [scripts/README.md](./scripts/README.md)
- **é¡¹ç›®æ–‡æ¡£**: [CLAUDE.md](./CLAUDE.md)
- **API æ–‡æ¡£**: [README.md](./README.md)

---

## ğŸ‰ æ€»ç»“

### å®Œæˆæƒ…å†µ

âœ… **å·²å®Œæˆ**:
- ç¡®è®¤æˆ¿é—´æµè§ˆåŠŸèƒ½å·²æ­£ç¡®å®ç°
- åˆ›å»ºå®Œæ•´çš„æˆ¿é—´æ¸…é™¤ç³»ç»Ÿ
- ç¼–å†™è¯¦ç»†çš„ä½¿ç”¨æ–‡æ¡£
- æä¾›å¤šç§ä½¿ç”¨æ–¹å¼
- æ·»åŠ å®‰å…¨ä¿æŠ¤æœºåˆ¶

### åŠŸèƒ½äº®ç‚¹

1. âœ¨ **æ™ºèƒ½æ¸…ç†** - é»˜è®¤åªåˆ é™¤éæ´»è·ƒæˆ¿é—´
2. âœ¨ **å®‰å…¨ä¿æŠ¤** - äº¤äº’å¼ç¡®è®¤ + äº‹åŠ¡ä¿æŠ¤
3. âœ¨ **çµæ´»ä½¿ç”¨** - å¤šç§æ¨¡å¼å’Œé€‰é¡¹
4. âœ¨ **å®Œæ•´æ–‡æ¡£** - è¯¦ç»†çš„ä½¿ç”¨è¯´æ˜å’Œç¤ºä¾‹
5. âœ¨ **æ˜“äºé›†æˆ** - ç®€å•çš„ npm å‘½ä»¤

### å‡†å¤‡å°±ç»ª

ğŸš€ **æ‰€æœ‰åŠŸèƒ½å·²å®ç°å¹¶å¯ç«‹å³ä½¿ç”¨ï¼**

- âœ… ä»£ç å·²å®Œæˆ
- âœ… æ–‡æ¡£å·²ç¼–å†™
- âœ… Patch æ–‡ä»¶å·²ç”Ÿæˆ
- â³ å¾…ç”¨æˆ·æµ‹è¯•éªŒè¯

---

**å®Œæˆæ—¥æœŸ**: 2025-01-02
**ç‰ˆæœ¬**: 1.0.0
**çŠ¶æ€**: âœ… å·²å®Œæˆ
